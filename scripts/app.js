/**
 * grrd's Reversi
 * Copyright (c) 2022 Gerard Tyedmers, grrd@gmx.net
 * @license MPL-2.0
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
!function(){"use strict";let e=0;const n=[{lCode:"en",lLang:"English",lDesc:"grrd's Reversi is a free HTML5 Game that works offline.",l2Players:"2 Players",lEasy:"Easy",lMedium:"Medium",lHard:"Hard",lOnline:"Online",lHelp:"Place your stone so that at least one of your opponent's stones is flanked by your stones. All of your opponent's stones between your pieces are then flipped over to become your color. \nThe object of the game is to own more stones than your opponent when the game is over. ",lDev:"Developed by Gérard Tyedmers.",lLook:"Have a look at my other games:",lSelLang:"Select language",lShow:"Show possible moves",lSound:"Play sounds",lBegin:" begins.",lOver:"Game over. ",lWin:" wins!",lDraw:" It's a draw!",lTurn:"'s turn.",lNoMove:" can't move. ",lNobodyMove:"Game over, no player can move. ",lNotHere:" can't play here."},{lCode:"de",lLang:"Deutsch",lDesc:"grrd's Reversi ist ein kostenloses HTML5 Spiel, welches offline funktioniert.",l2Players:"2 Spieler",lEasy:"Einfach",lMedium:"Mittel",lHard:"Schwer",lOnline:"Online",lHelp:"Platziere deinen Stein so, dass er mindestens einen Stein deines Gegners einklemmt. Alle eingeklemmten Steine werden dann umgedreht und wechseln zu deiner Farbe.\nZiel des Spiels ist es, beim Spielende mehr Steine als der Gegner zu haben. ",lDev:"Entwickelt von Gérard Tyedmers.",lLook:"Schau dir auch meine anderen Spiele an:",lSelLang:"Sprache wählen",lShow:"Mögliche Züge anzeigen",lSound:"Töne abspielen",lBegin:" beginnt.",lOver:"Spiel beendet. ",lWin:" gewinnt!",lDraw:" Unentschieden!",lTurn:" ist am Zug.",lNoMove:" kann nicht ziehen. ",lNobodyMove:"Spiel beendet, kein Spieler kann ziehen. ",lNotHere:" kann hier nicht spielen."},{lCode:"fr",lLang:"Francais",lDesc:"grrd's Reversi est un jeu en HTML5 qui fonctionne hors ligne.",l2Players:"2 Joueurs",lEasy:"Simple",lMedium:"Moyens",lHard:"Difficile",lOnline:"En ligne",lHelp:"Place ton pion de manière à ce qu'il coince au moins un pion de ton adversaire. Tous les pions coincés sont alors retournés et changent de couleur. Le but du jeu est d'avoir plus de pions que l'adversaire à la fin de la partie. ",lDev:"Développé par Gérard Tyedmers.",lLook:"Regarde aussi mes autres jeux:",lSelLang:"Choisir la langue",lShow:"Afficher les mouvements possibles",lSound:"Jouer des sons",lBegin:" commence.",lOver:"Jeu terminé. ",lWin:" gagne!",lDraw:" Match nul!",lTurn:" au tour.",lNoMove:" ne peut pas jouer. ",lNobodyMove:"Jeu terminé, aucun joueur ne peut bouger. ",lNotHere:" ne peut pas jouer ici."}];let s=0,l=[];const o=["black","white"],t=["<img class='w25' src='images/stone_black.svg' alt='Black'>","<img class='w25' src='images/stone_white.svg' alt='White'>"],i=function(e){return document.getElementById(e)},r=i("iPlayground"),a=i("iMessage");let c=!0,u=!0;const d=function(){const e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}();function m(){e&&document.documentElement.setAttribute("lang",n[e].lCode),document.querySelector("meta[name='description']").setAttribute("content",n[e].lDesc),i("l2Players").innerHTML=n[e].l2Players,i("lEasy").innerHTML=n[e].lEasy,i("lMedium").innerHTML=n[e].lMedium,i("lHard").innerHTML=n[e].lHard,i("lHelp").innerHTML=n[e].lHelp,i("lDev").innerHTML=n[e].lDev,i("lLook").innerHTML=n[e].lLook,i("lSelLang").innerHTML=n[e].lSelLang,i("lShow").innerHTML=n[e].lShow,i("lSound").innerHTML=n[e].lSound}function g(u){l[0]="human",l[1]=u.target.getAttribute("data-player2"),function(){let u;for(const e of r.children)e.className="empty";if(r.children[28].className=o[0],r.children[35].className=o[0],r.children[27].className=o[1],r.children[36].className=o[1],s=0,u=y(v()),a.innerHTML=t[s]+n[e].lBegin,i("iScore1").innerHTML=t[0]+" "+document.getElementsByClassName(o[0]).length,i("iScore2").innerHTML=document.getElementsByClassName(o[1]).length+" "+t[1],"human"!==l[s])L(u);else if(c)for(const e of u)r.children[e.nID].classList.add("ok")}(),iTitle.classList.remove("swipe-out-right"),iGame.classList.remove("swipe-in-left"),iTitle.classList.add("swipe-out"),iGame.classList.add("swipe-in")}function h(){iTitle.classList.remove("swipe-out"),iGame.classList.remove("swipe-in"),iTitle.classList.add("swipe-out-right"),iGame.classList.add("swipe-in-left")}function p(e){return{nRow:Math.trunc(e/8),nCol:e%8}}function f(e,n){const l=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];let t,i=[];if("empty"!==n[e])return i;for(const r of l){let l=[];for(t=1;0<=e+t*r[0]*8+t*r[1]&&e+t*r[0]*8+t*r[1]<=63&&Math.floor(e/8)===Math.floor((e+t*r[1])/8);){if(n[e+t*r[0]*8+t*r[1]]!==o[1-s]){if(n[e+t*r[0]*8+t*r[1]]===o[s]&&l.length>0){i=i.concat(l),i.includes(e)||i.push(e);break}break}l.push(e+t*r[0]*8+t*r[1]),t+=1}}return i}function v(){let e=[];for(const n of r.children)e.push(n.classList.contains(o[0])?o[0]:n.classList.contains(o[1])?o[1]:"empty");return e}function y(e){let n=[],s=[];for(const[l,o]of e.entries())"empty"===o&&(s=f(l,e),s.length>0&&n.push({nID:l,lStones:s}));return n}function S(d){let m=Array.prototype.indexOf.call(d.parentNode.children,d),g=[];const h=f(m,v());for(const e of r.getElementsByClassName("wrong"))e.classList.remove("wrong");if(h.length>0){for(const e of h)r.children[e].classList.contains("white")||r.children[e].classList.contains("white")?(r.children[e].className="",r.children[e].className=o[s]):r.children[e].className=o[s];u&&document.getElementById("woosh_sound").play();for(const e of r.children)e.classList.remove("ok");if(0===document.getElementsByClassName("empty").length)a.innerHTML=n[e].lOver,document.getElementsByClassName(o[0]).length>document.getElementsByClassName(o[1]).length?a.innerHTML+=t[0]+n[e].lWin:document.getElementsByClassName(o[0]).length<document.getElementsByClassName(o[1]).length?a.innerHTML+=t[1]+n[e].lWin:a.innerHTML+=" It's a draw!",u&&setTimeout((function(){document.getElementById("ding_sound").play()}),500);else if(s=1-s,g=y(v()),g.length>0){if(a.innerHTML=t[s]+n[e].lTurn,"human"!==l[s])L(g);else if(c)for(const e of g)r.children[e.nID].classList.add("ok")}else if(s=1-s,g=y(v()),g.length>0){if(a.innerHTML=t[1-s]+n[e].lNoMove+t[s]+n[e].lTurn,"human"!==l[s])L(g);else if(c)for(const e of g)r.children[e.nID].classList.add("ok")}else a.innerHTML=n[e].lNobodyMove,document.getElementsByClassName(o[0]).length>document.getElementsByClassName(o[1]).length?a.innerHTML+=t[0]+n[e].lWin:document.getElementsByClassName(o[0]).length<document.getElementsByClassName(o[1]).length?a.innerHTML+=t[1]+n[e].lWin:a.innerHTML+=n[e].lDraw,u&&setTimeout((function(){document.getElementById("ding_sound").play()}),500)}else a.innerHTML=t[s]+n[e].lNotHere,r.children[m].classList.add("wrong");i("iScore1").innerHTML=t[0]+" "+document.getElementsByClassName(o[0]).length,i("iScore2").innerHTML=document.getElementsByClassName(o[1]).length+" "+t[1]}function b(e,n){const l=[0,1,2,3,4,5,6,7,8,15,16,23,24,31,32,39,40,47,48,55,56,57,58,59,60,61,62,63],t=[9,10,11,12,13,14,17,22,25,30,33,38,41,46,49,50,51,52,53,54];let i;for(const r of e){if(r.lPlayground=[...n],r.lStones.forEach(e=>{r.lPlayground[e]=o[s]}),r.nScore=r.lStones.length,r.nScore+=20*r.lStones.filter(e=>l.includes(e)).length,l.includes(r.nID)){let e,n,s,l=[],o=1,t=0;for(0===p(r.nID).nRow?(e=0,n=1,s=p(r.nID).nCol):7===p(r.nID).nRow?(e=56,n=1,s=p(r.nID).nCol):0===p(r.nID).nCol?(e=0,n=8,s=p(r.nID).nRow):7===p(r.nID).nCol&&(e=7,n=8,s=p(r.nID).nRow),i=0;i<8;i+=1)l.push(e+i*n);for(i=s-1;i>=0;i-=1){if(r.lPlayground[l[i]]!==r.lPlayground[l[s]]){if("empty"===r.lPlayground[l[i]]){t+=1;break}t+=2;break}o+=1}for(i=s+1;i<8;i+=1){if(r.lPlayground[l[i]]!==r.lPlayground[l[s]]){if("empty"===r.lPlayground[l[i]]){t+=1;break}t+=2;break}o+=1}o>1&&3!==t&&(r.nScore+=20*o),3===t&&(r.nScore-=20)}r.nScore-=3*r.lStones.filter(e=>t.includes(e)).length,r.lPossibleGemstones=[];let e,a,c,u,d=[{nID:0,lDir:[1,1]},{nID:7,lDir:[-1,1]},{nID:56,lDir:[1,-1]},{nID:63,lDir:[-1,-1]}];for(i=0;i<4;i+=1){for(e=0,a=0,c=7;a<7;){for(;r.lPlayground[d[i].nID+e*d[i].lDir[0]+8*a*d[i].lDir[1]]===o[s]&&e<c;)r.lPossibleGemstones.push(d[i].nID+e*d[i].lDir[0]+8*a*d[i].lDir[1]),e+=1;c=e-1,a+=1,e=0}for(e=0,a=0,u=7;e<7;){for(;r.lPlayground[d[i].nID+e*d[i].lDir[0]+8*a*d[i].lDir[1]]===o[s]&&a<u;)r.lPossibleGemstones.push(d[i].nID+e*d[i].lDir[0]+8*a*d[i].lDir[1]),a+=1;u=a-1,e+=1,a=0}}r.lPossibleGemstones=[...new Set(r.lPossibleGemstones)],r.lGemstones=r.lStones.filter(e=>r.lPossibleGemstones.includes(e)),r.nScore+=1e3*r.lGemstones.length,r.lPossibleGemstonesNeighbours=[],"empty"===r.lPlayground[0]&&(r.lPossibleGemstonesNeighbours.push(1),r.lPossibleGemstonesNeighbours.push(9),r.lPossibleGemstonesNeighbours.push(8)),"empty"===r.lPlayground[7]&&(r.lPossibleGemstonesNeighbours.push(6),r.lPossibleGemstonesNeighbours.push(14),r.lPossibleGemstonesNeighbours.push(15)),"empty"===r.lPlayground[56]&&(r.lPossibleGemstonesNeighbours.push(48),r.lPossibleGemstonesNeighbours.push(49),r.lPossibleGemstonesNeighbours.push(57)),"empty"===r.lPlayground[63]&&(r.lPossibleGemstonesNeighbours.push(55),r.lPossibleGemstonesNeighbours.push(54),r.lPossibleGemstonesNeighbours.push(62)),0===r.lGemstones.length&&(r.lGemstonesNeighbours=r.lStones.filter(e=>r.lPossibleGemstonesNeighbours.includes(e)),r.nScore-=80*r.lGemstonesNeighbours.length,r.nScore-=100*r.lGemstonesNeighbours.filter(e=>[9,14,49,54].includes(e)).length)}return e}function L(e){let n=v();e=b(e,n),s=1-s;for(const n of e)n.lPossibleMovesOpponent=y(n.lPlayground),0===n.lPossibleMovesOpponent.length?n.nScore=1e5*Math.abs(n.nScore):(n.lPossibleMovesOpponent=b(n.lPossibleMovesOpponent,n.lPlayground),n.lPossibleMovesOpponent.sort((e,n)=>n.nScore-e.nScore),n.nScore=n.nScore-.8*n.lPossibleMovesOpponent[0].nScore,s=1-s,n.lPossibleMovesOpponent[0].lPossibleMovesPlayer=y(n.lPossibleMovesOpponent[0].lPlayground),n.lPossibleMovesOpponent[0].lPossibleMovesPlayer.length>0&&(n.lPossibleMovesOpponent[0].lPossibleMovesPlayer=b(n.lPossibleMovesOpponent[0].lPossibleMovesPlayer,n.lPossibleMovesOpponent[0].lPlayground),n.lPossibleMovesOpponent[0].lPossibleMovesPlayer.sort((e,n)=>n.nScore-e.nScore),n.nScore=n.nScore+.6*n.lPossibleMovesOpponent[0].lPossibleMovesPlayer[0].nScore),s=1-s);s=1-s,e.sort((e,n)=>n.nScore-e.nScore);let o=e[0].nScore;"hard"!==l[s]&&(o=(e.filter(e=>e.nScore<o)[0]??e[0]).nScore),"medium"===l[s]&&(o=(e.filter(e=>e.nScore<o)[0]??e[e.length-1]).nScore),"easy"===l[s]&&(o=e[e.length-1].nScore);const t=e.filter(e=>e.nScore>=o).length,i=Math.floor(Math.random()*t);setTimeout((function(){S(r.children[e[i].nID])}),1e3)}function P(e){return function(){"human"===l[s]&&S(e)}}function M(e){i("iTitleFieldset").disabled=!0,document.activeElement.blur(),e.classList.remove("popup-init"),e.classList.remove("popup-hide"),e.classList.add("popup-show")}function N(e){i("iTitleFieldset").disabled=!1,e.classList.remove("popup-show"),e.classList.add("popup-hide")}!function(){const n=(function(e){let n=new URLSearchParams(window.location.search);return!!n.has(e)&&n.get(e)}("lang")||navigator.language||navigator.browserLanguage||(navigator.languages||["en"])[0]).substring(0,2).toLowerCase();let s,l;"de"===n?e=1:"fr"===n&&(e=2),d&&(e=null===localStorage.getItem("s_reversi_lang")?e:parseInt(localStorage.getItem("s_reversi_lang")),i("iLang").value=e,c=null===localStorage.getItem("s_reversi_show")?e:"true"===localStorage.getItem("s_reversi_show"),i("iShowMoves").checked=c,u=null===localStorage.getItem("s_reversi_sound")?1:"true"===localStorage.getItem("s_reversi_sound"),u=i("iSound").checked=u),m(),"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("sw.js").then((function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)}),(function(e){console.log("ServiceWorker registration failed: ",e)}))})),document.getElementsByClassName("eWhite")[0].classList.remove("vanishWhite"),document.getElementsByClassName("eBlack")[0].classList.add("vanish"),i("iHeaderSettings").appendChild(i("iTitleImg").cloneNode(!0)),i("iHeaderInfo").appendChild(i("iTitleImg").cloneNode(!0)),Array.from(document.getElementsByClassName("eBlack")).forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.toggle("vanish"),e.target.parentNode.getElementsByClassName("eWhite")[0].classList.toggle("vanishWhite"),u&&document.getElementById("woosh_sound").play()}))})),setTimeout((function(){document.getElementsByClassName("eWhite")[1].classList.remove("vanishWhite"),document.getElementsByClassName("eBlack")[1].classList.add("vanish")}),1e3),setTimeout((function(){document.getElementsByClassName("eWhite")[0].classList.add("vanishWhite"),document.getElementsByClassName("eBlack")[0].classList.remove("vanish")}),1500),setTimeout((function(){document.getElementsByClassName("eWhite")[0].classList.remove("vanishWhite"),document.getElementsByClassName("eBlack")[0].classList.add("vanish")}),2500),setTimeout((function(){document.getElementsByClassName("eWhite")[1].classList.add("vanishWhite"),document.getElementsByClassName("eBlack")[1].classList.remove("vanish")}),3e3),i("iInfo").addEventListener("click",(function(){M(i("iPopupInfo"))})),i("iInfoClose").addEventListener("click",(function(){N(i("iPopupInfo"))})),i("iSettings").addEventListener("click",(function(){M(i("iPopupSettings"))})),i("iSettingsClose").addEventListener("click",(function(){e=i("iLang").value,m(),c=i("iShowMoves").checked,u=i("iSound").checked,d&&(localStorage.setItem("s_reversi_lang",e),localStorage.setItem("s_reversi_show",c),localStorage.setItem("s_reversi_sound",u)),N(i("iPopupSettings"))})),i("iLang").addEventListener("change",(function(){e=i("iLang").value,m()})),Array.from(document.getElementsByClassName("list-button")).forEach((function(e){e.addEventListener("click",g)})),i("iClose").addEventListener("click",h);for(s=0;s<64;s+=1)l=document.createElement("div"),r.appendChild(l),l.onclick=P(l)}()}();